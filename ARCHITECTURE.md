# Архитектура проекта Grassi Grosso

## 📋 Содержание

1. [Текущая архитектура (Этап 1)](#текущая-архитектура-этап-1)
2. [Схема обработки форм обратной связи](#схема-обработки-форм-обратной-связи)
3. [Планируемое масштабирование производительности](#планируемое-масштабирование-производительности)
4. [Система администрирования (WordPress)](#система-администрирования-wordpress)
5. [Интеграция WooCommerce](#интеграция-woocommerce)
6. [Дорожная карта развития](#дорожная-карта-развития)

---

## Текущая архитектура (Этап 1)

### Общая схема системы

```
┌─────────────────────────────────────────────────────────────────┐
│                        БРАУЗЕР ПОЛЬЗОВАТЕЛЯ                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Многостраничный лендинг:                                 │  │
│  │  • index.html (главная)                                   │  │
│  │  • hotels.html (отелям)                                    │  │
│  │  • dealers.html (дилерам)                                 │  │
│  │  • catalog.html (каталог)                                 │  │
│  │  • documents.html (документы)                             │  │
│  └──────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  JavaScript логика (src/main.js):                        │  │
│  │  • GSAP анимации                                          │  │
│  │  • Слайдеры коллекций (LERP + parallax)                  │  │
│  │  • Слайдеры отзывов (infinite loop)                      │  │
│  │  • Мобильное меню                                         │  │
│  │  • FAQ аккордеон                                          │  │
│  │  • Валидация и отправка форм                              │  │
│  │  • Cookie banner                                           │  │
│  │  • Preloader с ожиданием загрузки шрифтов                │  │
│  └──────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Стили (src/style.css):                                   │  │
│  │  • Адаптивный дизайн                                      │  │
│  │  • Кастомные шрифты (Bounded, Nunito)                    │  │
│  │  • Анимации и переходы                                   │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ HTTP/HTTPS запросы
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    NGINX (обратный прокси)                       │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  • Проксирование /api/* → Node.js                        │  │
│  │  • Отдача статических файлов из /dist                    │  │
│  │  • Кеширование статики                                   │  │
│  │  • SSL/TLS терминация                                    │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
          /api/* запросы        Статические файлы
                    │                   │
                    ▼                   ▼
┌─────────────────────────────────────────────────────────────────┐
│              NODE.JS + EXPRESS SERVER (server.cjs)               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  API Endpoints:                                           │  │
│  │  • GET  /health - Healthcheck                            │  │
│  │  • GET  /api/test - Тест API                             │  │
│  │  • POST /api/test - Тест POST API                        │  │
│  │  • GET  /api/get-chat-id - Получение Chat ID Telegram    │  │
│  │  • POST /api/submit - Обработка форм обратной связи      │  │
│  └──────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Middleware:                                              │  │
│  │  • CORS (разрешение кросс-доменных запросов)            │  │
│  │  • express.json() - парсинг JSON                         │  │
│  │  • express.urlencoded() - парсинг форм                   │  │
│  │  • http-proxy-middleware (dev режим → Vite)             │  │
│  └──────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Production режим:                                        │  │
│  │  • Отдача статики из /dist                               │  │
│  │  • Fallback на index.html для SPA                        │  │
│  └──────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Development режим:                                       │  │
│  │  • Проксирование на Vite dev server (localhost:5173)    │  │
│  │  • Hot Module Replacement (HMR)                          │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │
                    ┌─────────┴─────────┐
                    │                   │
                    ▼                   ▼
        ┌───────────────────┐  ┌───────────────────┐
        │  TELEGRAM BOT API │  │  EMAIL SERVICE    │
        │  (Этап 1)         │  │  (Этап 1)         │
        └───────────────────┘  └───────────────────┘
```

### Детальная схема фронтенда (Vite)

```
┌─────────────────────────────────────────────────────────────────┐
│                    VITE BUILD SYSTEM                             │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Development Mode (npm run dev):                          │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Vite Dev Server (localhost:5173)                  │  │  │
│  │  │  • Мгновенный запуск (< 1 сек)                     │  │  │
│  │  │  • Hot Module Replacement (HMR)                    │  │  │
│  │  │    - Изменения в JS/CSS видны мгновенно            │  │  │
│  │  │    - Состояние компонентов сохраняется             │  │  │
│  │  │  • Быстрая перезагрузка HTML                        │  │  │
│  │  │  • Проксирование /api/* → Node.js (localhost:3000) │  │  │
│  │  │  • Source maps для отладки                          │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Production Build (npm run build):                       │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Rollup (bundler):                                 │  │  │
│  │  │  • Мультистраничная сборка:                        │  │  │
│  │  │    - index.html → dist/index.html                  │  │  │
│  │  │    - hotels.html → dist/hotels.html                │  │  │
│  │  │    - dealers.html → dist/dealers.html              │  │  │
│  │  │    - catalog.html → dist/catalog.html              │  │  │
│  │  │    - documents.html → dist/documents.html          │  │  │
│  │  │  • Code splitting:                                  │  │  │
│  │  │    - Каждая страница = отдельный entry point       │  │  │
│  │  │    - Общий код выносится в chunks                  │  │  │
│  │  │  • Минификация JS/CSS                              │  │  │
│  │  │  • Tree shaking (удаление неиспользуемого кода)     │  │  │
│  │  │  • Оптимизация импортов                            │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Asset Processing:                                 │  │  │
│  │  │  • Оптимизация изображений                         │  │  │
│  │  │  • Генерация hash для cache busting                │  │  │
│  │  │  • Inline маленьких assets (< 4KB)                 │  │  │
│  │  │  • CSS extraction и минификация                    │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │
│  │  │  Output:                                            │  │  │
│  │  │  dist/                                              │  │  │
│  │  │  ├── index.html                                     │  │  │
│  │  │  ├── hotels.html                                    │  │  │
│  │  │  ├── dealers.html                                   │  │  │
│  │  │  ├── catalog.html                                   │  │  │
│  │  │  ├── documents.html                                 │  │  │
│  │  │  ├── assets/                                        │  │  │
│  │  │  │   ├── index-[hash].js                           │  │  │
│  │  │  │   ├── hotels-[hash].js                           │  │  │
│  │  │  │   ├── style-[hash].css                           │  │  │
│  │  │  │   └── ...                                        │  │  │
│  │  │  └── ...                                            │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ПРЕИМУЩЕСТВА VITE:                                              │
│  • ⚡ Мгновенный запуск dev-сервера (ESM нативно)               │
│  • 🔥 Hot Module Replacement без перезагрузки страницы          │
│  • 📦 Оптимизированная сборка (Rollup)                          │
│  • 🎯 Мультистраничная архитектура из коробки                    │
│  • 🔧 Простая конфигурация (vite.config.mjs)                    │
│  • 📊 Source maps для отладки                                    │
└─────────────────────────────────────────────────────────────────┘
```

### Детальная схема Docker контейнеризации

```
┌─────────────────────────────────────────────────────────────────┐
│                    DOCKER MULTI-STAGE BUILD                      │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  STAGE 1: BUILD (node:22-slim)                           │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  1. Копирование package.json, package-lock.json    │  │  │
│  │  │  2. npm ci (чистая установка зависимостей)         │  │  │
│  │  │  3. Копирование исходного кода                      │  │  │
│  │  │  4. npm run build (Vite сборка)                    │  │  │
│  │  │     → Генерация /dist с оптимизированными файлами  │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ COPY --from=build                │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  STAGE 2: RUNTIME (node:22-slim)                        │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  • Установка curl (для healthcheck)               │  │  │
│  │  │  • npm ci --omit=dev (только production deps)     │  │  │
│  │  │  • Копирование server.cjs из build stage          │  │  │
│  │  │  • Копирование /dist из build stage               │  │  │
│  │  │  • EXPOSE 3000                                     │  │  │
│  │  │  • HEALTHCHECK (каждые 10 сек)                    │  │  │
│  │  │  • CMD ["node", "server.cjs"]                     │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  DEPLOYMENT (Timeweb Cloud Apps / VPS / K8s):            │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Docker Container:                                 │  │  │
│  │  │  • Изолированное окружение                         │  │  │
│  │  │  • Переменные окружения (.env)                     │  │  │
│  │  │  • Автоматический healthcheck                      │  │  │
│  │  │  • Легкое масштабирование (docker-compose scale)   │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ПРЕИМУЩЕСТВА DOCKER:                                            │
│  • 🐳 Одинаковое окружение на dev/stage/prod                    │
│  • 🚀 Быстрый деплой одной командой (docker build/run)          │
│  • 📦 Легкое масштабирование (горизонтальное)                   │
│  • 🔒 Изоляция зависимостей и конфигурации                      │
│  • 🔄 Откат к предыдущей версии (docker tag)                    │
│  • 🛠️  Интеграция с CI/CD (GitHub Actions, GitLab CI)          │
└─────────────────────────────────────────────────────────────────┘
```

---

## Схема обработки форм обратной связи

### Детальный поток обработки формы (Этап 1)

```
┌─────────────────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬ ЗАПОЛНЯЕТ ФОРМУ                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Форма на странице (index.html, hotels.html, etc):      │  │
│  │  • Поле: Имя (обязательное, min 2 символа)               │  │
│  │  • Поле: Телефон (обязательное, валидация формата)        │  │
│  │  • Поле: Email (опциональное, валидация формата)         │  │
│  │  • Поле: Компания (опциональное)                         │  │
│  │  • Поле: Город (опциональное)                            │  │
│  │  • Поле: Сообщение (опциональное)                        │  │
│  │  • Чекбокс: Согласие на обработку данных (обязательное)  │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ submit event
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│              КЛИЕНТСКАЯ ВАЛИДАЦИЯ (src/main.js)                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  validateForm(form):                                    │  │
│  │  • Проверка обязательных полей                          │  │
│  │  • Валидация формата телефона (regex)                   │  │
│  │  • Валидация формата email (regex)                      │  │
│  │  • Проверка согласия на обработку данных                │  │
│  │  • Показ ошибок под полями (если есть)                   │  │
│  │  • Прокрутка к первой ошибке                             │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ Валидация успешна
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│              ОТПРАВКА ДАННЫХ (fetch API)                          │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  POST /api/submit                                        │  │
│  │  {                                                       │  │
│  │    "name": "Иван Иванов",                                │  │
│  │    "phone": "+7 (999) 123-45-67",                       │  │
│  │    "email": "ivan@example.com",                         │  │
│  │    "company": "ООО Компания",                            │  │
│  │    "city": "Москва",                                     │  │
│  │    "comment": "Интересует каталог",                      │  │
│  │    "page": "Главная страница"                            │  │
│  │  }                                                       │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ HTTP POST
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│          NODE.JS SERVER - POST /api/submit HANDLER               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  1. Получение данных из req.body                         │  │
│  │  2. Валидация на сервере (дополнительная проверка)       │  │
│  │  3. Экранирование Markdown символов                       │  │
│  │  4. Формирование сообщения                              │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                    ▼                   ▼
┌──────────────────────────┐  ┌──────────────────────────┐
│  ОТПРАВКА В TELEGRAM     │  │  ОТПРАВКА EMAIL          │
│  (Этап 1)                │  │  (Этап 1)                │
│                          │  │                          │
│  ┌────────────────────┐  │  │  ┌────────────────────┐  │
│  │  Telegram Bot API: │  │  │  │  Email Service:    │  │
│  │  • BOT_TOKEN       │  │  │  │  • SMTP сервер      │  │
│  │  • CHAT_ID         │  │  │  │  • nodemailer      │  │
│  │  • Формат:         │  │  │  │  • Шаблон письма   │  │
│  │    Markdown        │  │  │  │  • HTML + текст    │  │
│  │  • Уведомление     │  │  │  │  • От: noreply@    │  │
│  │    менеджерам      │  │  │  │  • К: sales@       │  │
│  └────────────────────┘  │  │  └────────────────────┘  │
│                          │  │                          │
│  ✅ Мгновенное           │  │  ✅ Официальное          │
│     уведомление          │  │     уведомление          │
│  ✅ Мобильные            │  │  ✅ История в почте       │
│     уведомления          │  │  ✅ Прикрепления          │
│  ✅ Простота             │  │  ✅ Профессиональный     │
│     интеграции           │  │     вид                   │
│  └────────────────────┘  │  └────────────────────┘  │
└──────────────────────────┘  └──────────────────────────┘
                    │                   │
                    └─────────┬─────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ОБРАБОТКА РЕЗУЛЬТАТА                          │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  • Если обе отправки успешны → 200 OK                    │  │
│  │  • Если одна из отправок не удалась → 500 Error          │  │
│  │  • Логирование результата в console                      │  │
│  │  • Возврат ответа клиенту                                │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ JSON Response
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    КЛИЕНТ ПОЛУЧАЕТ ОТВЕТ                         │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  • Успех: alert("Заявка отправлена!")                    │  │
│  │  • Ошибка: alert("Ошибка сервера. Попробуйте позже.")    │  │
│  │  • Очистка формы (если успех)                            │  │
│  │  • Разблокировка кнопки отправки                          │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### Схема интеграции с Битрикс24 (Этап 2 - будущее)

```
┌─────────────────────────────────────────────────────────────────┐
│          NODE.JS SERVER - POST /api/submit HANDLER               │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  1. Получение и валидация данных                         │  │
│  │  2. Экранирование данных                                │  │
│  │  3. Формирование сообщений                              │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                    ▼                   ▼
┌──────────────────────────┐  ┌──────────────────────────┐
│  TELEGRAM (сохраняется)  │  │  EMAIL (сохраняется)     │
└──────────────────────────┘  └──────────────────────────┘
                    │                   │
                    └─────────┬─────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│          ИНТЕГРАЦИЯ С БИТРИКС24 CRM (НОВОЕ)                      │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Битрикс24 REST API:                                     │  │
│  │  • Webhook URL: https://your-domain.bitrix24.ru/rest/   │  │
│  │  • Метод: crm.lead.add или crm.deal.add                 │  │
│  │  • Аутентификация: OAuth токен                          │  │
│  │  • Данные:                                               │  │
│  │    {                                                     │  │
│  │      "TITLE": "Заявка с сайта",                         │  │
│  │      "NAME": "Иван",                                     │  │
│  │      "LAST_NAME": "Иванов",                             │  │
│  │      "PHONE": [{"VALUE": "+79991234567"}],              │  │
│  │      "EMAIL": [{"VALUE": "ivan@example.com"}],         │  │
│  │      "COMMENTS": "Интересует каталог",                  │  │
│  │      "SOURCE_ID": "WEB",                                │  │
│  │      "UF_CRM_PAGE": "Главная страница"                  │  │
│  │    }                                                     │  │
│  └──────────────────────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Преимущества интеграции с Битрикс24:                    │  │
│  │  • ✅ Автоматическое создание лида/сделки                │  │
│  │  • ✅ Назначение ответственного менеджера                │  │
│  │  • ✅ Автоматизация воронки продаж                      │  │
│  │  • ✅ История коммуникаций в одном месте                 │  │
│  │  • ✅ Аналитика и отчеты                                │  │
│  │  • ✅ Интеграция с телефонией                           │  │
│  │  • ✅ Email-трекинг                                      │  │
│  │  • ✅ Уведомления менеджерам в CRM                      │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ОБРАБОТКА РЕЗУЛЬТАТА                          │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  • Telegram отправлен → ✅                               │  │
│  │  • Email отправлен → ✅                                   │  │
│  │  • Битрикс24 лид создан → ✅                              │  │
│  │  • Если все успешно → 200 OK                             │  │
│  │  • Если Битрикс24 недоступен → fallback на Telegram/Email│  │
│  │  • Логирование всех операций                             │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

### Детальная схема Email отправки (Этап 1)

```
┌─────────────────────────────────────────────────────────────────┐
│              NODE.JS SERVER - EMAIL MODULE                       │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Зависимости:                                            │  │
│  │  • nodemailer (npm package)                              │  │
│  │  • dotenv (переменные окружения)                         │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Конфигурация (.env):                                    │  │
│  │  • SMTP_HOST=smtp.gmail.com (или другой SMTP)           │  │
│  │  • SMTP_PORT=587                                         │  │
│  │  • SMTP_SECURE=false (true для 465)                     │  │
│  │  • SMTP_USER=noreply@grassigrosso.ru                    │  │
│  │  • SMTP_PASS=app_password                                │  │
│  │  • EMAIL_TO=sales@grassigrosso.ru                       │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Формирование письма:                                    │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  From: noreply@grassigrosso.ru                     │  │  │
│  │  │  To: sales@grassigrosso.ru                         │  │  │
│  │  │  Subject: Новая заявка с сайта Grassi Grosso       │  │  │
│  │  │  Content-Type: text/html; charset=utf-8            │  │  │
│  │  │                                                     │  │  │
│  │  │  HTML шаблон:                                      │  │  │
│  │  │  <!DOCTYPE html>                                    │  │  │
│  │  │  <html>                                            │  │  │
│  │  │  <body style="font-family: Arial, sans-serif;">   │  │  │
│  │  │    <h2>Новая заявка с сайта</h2>                  │  │  │
│  │  │    <p><strong>Страница:</strong> Главная</p>      │  │  │
│  │  │    <p><strong>Имя:</strong> Иван Иванов</p>       │  │  │
│  │  │    <p><strong>Телефон:</strong> +7 (999) 123-45-67│  │  │
│  │  │    <p><strong>Email:</strong> ivan@example.com</p>│  │  │
│  │  │    <p><strong>Компания:</strong> ООО Компания</p> │  │  │
│  │  │    <p><strong>Город:</strong> Москва</p>           │  │  │
│  │  │    <p><strong>Сообщение:</strong> Интересует каталог│  │  │
│  │  │    <hr>                                             │  │  │
│  │  │    <p><small>Дата: 2026-01-19 14:30:00</small></p> │  │  │
│  │  │  </body>                                            │  │  │
│  │  │  </html>                                            │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Отправка через SMTP:                                    │  │
│  │  • Создание транспорта (nodemailer.createTransport)     │  │
│  │  • Отправка (transporter.sendMail)                       │  │
│  │  • Обработка ошибок (try/catch)                          │  │
│  │  • Логирование результата                               │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    SMTP СЕРВЕР (Gmail / Yandex / др.)           │
│  • Аутентификация (SMTP_USER, SMTP_PASS)                      │
│  • Отправка письма получателю                                  │
│  • Возврат результата (success/error)                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ПОЧТОВЫЙ ЯЩИК МЕНЕДЖЕРА                        │
│  sales@grassigrosso.ru                                          │
│  • Получение письма                                            │
│  • Уведомление на email клиенте                                │
│  • История переписки                                            │
└─────────────────────────────────────────────────────────────────┘
```

---

## Планируемое масштабирование производительности

> ⚠️ **ВАЖНО:** Все описанные ниже оптимизации нужны только при высокой посещаемости и росте нагрузки. На текущем этапе они не требуются.

### Схема 2.1: Добавление Redis для кеширования

```
┌─────────────────────────────────────────────────────────────────┐
│                    ТЕКУЩАЯ АРХИТЕКТУРА (БЕЗ КЕША)                │
│                                                                   │
│  Браузер → Nginx → Node.js → Внешние API/БД                     │
│                              ↓                                    │
│                         Каждый запрос                             │
│                         обрабатывается                            │
│                         заново                                   │
└─────────────────────────────────────────────────────────────────┘

                              ▼

┌─────────────────────────────────────────────────────────────────┐
│              АРХИТЕКТУРА С REDIS КЕШИРОВАНИЕМ                     │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  БРАУЗЕР                                                 │  │
│  │  • Запрос страницы /api/catalog                          │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  NGINX                                                    │  │
│  │  • Проксирование запросов                                │  │
│  │  • Кеширование статики (если нужно)                     │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  NODE.JS + EXPRESS                                       │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Middleware: Redis Cache Layer                      │  │  │
│  │  │  1. Проверка кеша: redis.get(cacheKey)            │  │  │
│  │  │  2. Если есть в кеше → возврат из Redis           │  │  │
│  │  │  3. Если нет → обработка запроса                   │  │  │
│  │  │  4. Сохранение результата в Redis                  │  │  │
│  │  │  5. Возврат клиенту                                │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                    │                    │                       │
│        ┌───────────┴──────────┐         │                       │
│        │                      │         │                       │
│        ▼                      ▼         ▼                       │
│  ┌──────────┐        ┌──────────────┐  ┌──────────────┐       │
│  │  REDIS   │        │  Внешние API │  │  WordPress   │       │
│  │  Cache   │        │  (Telegram,  │  │  API / БД    │       │
│  │          │        │   Email)     │  │              │       │
│  │  • Кеш   │        │              │  │              │       │
│  │    API   │        │              │  │              │       │
│  │    ответов│        │              │  │              │       │
│  │  • TTL:  │        │              │  │              │       │
│  │    5-60  │        │              │  │              │       │
│  │    мин   │        │              │  │              │       │
│  │  • Rate  │        │              │  │              │       │
│  │    limit │        │              │  │              │       │
│  │    данные│        │              │  │              │       │
│  └──────────┘        └──────────────┘  └──────────────┘       │
└─────────────────────────────────────────────────────────────────┘

ПРЕИМУЩЕСТВА REDIS:
• ⚡ Снижение нагрузки на внешние API (Telegram, Email, WordPress)
• 🚀 Ускорение ответов (данные из памяти вместо сетевых запросов)
• 💰 Экономия ресурсов (меньше запросов к платным API)
• 🛡️  Rate limiting (защита от спама и DDoS)
• 📊 Счетчики и аналитика (просмотры, клики)
• 🔄 Сессии пользователей (если появится авторизация)
```

### Схема 2.2: Генерация статики через Node.js (SSG)

```
┌─────────────────────────────────────────────────────────────────┐
│          ТЕКУЩАЯ АРХИТЕКТУРА (ДИНАМИЧЕСКИЙ РЕНДЕРИНГ)            │
│                                                                   │
│  Запрос → Node.js → WordPress API → Рендеринг → HTML → Клиент  │
│                              ↓                                    │
│                    Каждый запрос = новая обработка               │
│                    Высокая нагрузка на сервер                   │
└─────────────────────────────────────────────────────────────────┘

                              ▼

┌─────────────────────────────────────────────────────────────────┐
│        АРХИТЕКТУРА С ГЕНЕРАЦИЕЙ СТАТИКИ (SSG / PRE-RENDER)        │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  BUILD TIME (периодически или по webhook):              │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Node.js Static Generator:                          │  │  │
│  │  │  1. Запрос данных из WordPress API                 │  │  │
│  │  │     • Товары каталога                              │  │  │
│  │  │     • Коллекции                                    │  │  │
│  │  │     • Статьи/контент                               │  │  │
│  │  │  2. Рендеринг HTML страниц:                        │  │  │
│  │  │     • catalog.html (со списком товаров)            │  │  │
│  │  │     • product-[id].html (страницы товаров)         │  │  │
│  │  │     • collection-[id].html (страницы коллекций)    │  │  │
│  │  │  3. Сохранение в /dist:                            │  │  │
│  │  │     dist/catalog.html                              │  │  │
│  │  │     dist/products/product-1.html                   │  │  │
│  │  │     dist/products/product-2.html                   │  │  │
│  │  │     dist/collections/collection-1.html             │  │  │
│  │  │  4. Инкрементальная регенерация (только измененные)│  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  RUNTIME (запросы пользователей):                        │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Браузер → Nginx → Статические HTML файлы         │  │  │
│  │  │  • Мгновенная отдача (нет обработки на сервере)   │  │  │
│  │  │  • Минимальная нагрузка на Node.js                │  │  │
│  │  │  • CDN-friendly (можно кешировать на CDN)         │  │  │
│  │  │  • SEO-friendly (полный HTML сразу)                │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ТРИГГЕРЫ РЕГЕНЕРАЦИИ:                                   │  │
│  │  • Webhook от WordPress (при изменении товара)         │  │
│  │  • Cron job (периодическая полная регенерация)          │  │
│  │  • Ручной запуск (npm run generate)                     │  │
│  │  • CI/CD pipeline (при деплое)                          │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

ПРЕИМУЩЕСТВА ГЕНЕРАЦИИ СТАТИКИ:
• ⚡ Максимальная скорость (статический HTML)
• 💰 Низкая нагрузка на сервер (рендеринг только при изменениях)
• 🌐 CDN-friendly (легко кешировать на CloudFlare, AWS CloudFront)
• 🔍 SEO-friendly (полный контент в HTML)
• 📦 Масштабируемость (статику можно отдавать с любого CDN)
• 🔄 Инкрементальная регенерация (только измененные страницы)
```

### Комбинированная схема: Redis + SSG

```
┌─────────────────────────────────────────────────────────────────┐
│              ОПТИМИЗИРОВАННАЯ АРХИТЕКТУРА (БУДУЩЕЕ)              │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  BUILD TIME:                                              │  │
│  │  WordPress → Node.js Generator → Static HTML → /dist     │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  RUNTIME:                                                │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Запрос статической страницы:                     │  │  │
│  │  │  Браузер → Nginx → /dist/*.html (мгновенно)       │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Запрос API (динамический):                       │  │  │
│  │  │  Браузер → Nginx → Node.js                        │  │  │
│  │  │  Node.js → Redis (проверка кеша)                  │  │  │
│  │  │  Если есть → возврат из Redis                     │  │  │
│  │  │  Если нет → WordPress API → Redis → Клиент        │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

РЕЗУЛЬТАТ:
• Статические страницы: максимальная скорость (CDN)
• Динамические API: кеширование в Redis
• Минимальная нагрузка на WordPress
• Готовность к высоким нагрузкам
```

---

## Система администрирования (WordPress)

### Вариант A: WordPress Монолит (рекомендуется)

```
┌─────────────────────────────────────────────────────────────────┐
│              WORDPRESS МОНОЛИТНАЯ АРХИТЕКТУРА                    │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  АДМИНИСТРАТОР / РЕДАКТОР                                │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  WordPress Admin Panel (wp-admin):                 │  │  │
│  │  │  • Редактирование страниц                          │  │  │
│  │  │  • Управление товарами (WooCommerce)               │  │  │
│  │  │  • Загрузка медиа (изображения, PDF)                │  │  │
│  │  │  • Управление меню                                 │  │  │
│  │  │  • Настройка форм (Contact Form 7)                │  │  │
│  │  │  • SEO настройки (Yoast SEO)                       │  │  │
│  │  │  • Плагины и темы                                  │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  WORDPRESS CORE + THEME                                  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Кастомная тема Grassi Grosso:                     │  │  │
│  │  │  • Повторяет текущий дизайн                        │  │  │
│  │  │  • Адаптивная верстка                              │  │  │
│  │  │  • Интеграция с WooCommerce                         │  │  │
│  │  │  • Кастомные шаблоны страниц                        │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Плагины:                                           │  │  │
│  │  │  • WooCommerce (интернет-магазин)                  │  │  │
│  │  │  • Contact Form 7 (формы обратной связи)           │  │  │
│  │  │  • Yoast SEO (SEO оптимизация)                     │  │  │
│  │  │  • WP Rocket (кеширование)                          │  │  │
│  │  │  • ACF (Advanced Custom Fields)                    │  │  │
│  │  │  • Custom плагин для Telegram/Email интеграции    │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  PHP + MySQL                                             │  │
│  │  • Обработка запросов                                   │  │
│  │  • Рендеринг HTML                                        │  │
│  │  • Работа с базой данных                                 │  │
│  │  • Обработка форм                                        │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  NGINX / APACHE                                          │  │
│  │  • Отдача готового HTML                                 │  │
│  │  • SSL/TLS                                               │  │
│  │  • Кеширование                                           │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  БРАУЗЕР ПОЛЬЗОВАТЕЛЯ                                   │  │
│  │  • Получает готовый HTML                                │  │
│  │  • Загружает стили и скрипты                            │  │
│  │  • Интерактивность через JavaScript                      │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

ПРЕИМУЩЕСТВА МОНОЛИТА ПЕРЕД HEADLESS:
• ✅ Меньше сложность архитектуры
  └─ Один стек (PHP + MySQL), один деплой, один хостинг
  └─ Не нужно синхронизировать фронтенд и backend
  └─ Меньше точек отказа

• ✅ Всё "из коробки"
  └─ Админка WordPress готова сразу
  └─ Роли пользователей (админ, редактор, автор)
  └─ Медиа-библиотека для изображений
  └─ Плагины работают напрямую
  └─ SEO плагины работают из коробки

• ✅ Дешевле поддержка
  └─ Проще найти WordPress разработчиков
  └─ Меньше DevOps работы
  └─ Меньше инфраструктурных затрат

• ✅ Редакторам проще
  └─ Знакомая админка WordPress
  └─ WYSIWYG редактор
  └─ Превью изменений
  └─ Не нужно знать API

• ✅ Меньше разработки
  └─ Готовая система форм
  └─ Готовая система комментариев
  └─ Готовая система поиска
  └─ Готовые виджеты и шорткоды
```

### Вариант B: Headless WordPress

```
┌─────────────────────────────────────────────────────────────────┐
│              HEADLESS WORDPRESS АРХИТЕКТУРА                      │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  АДМИНИСТРАТОР / РЕДАКТОР                                │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  WordPress Admin Panel (wp-admin):                 │  │  │
│  │  │  • Редактирование контента                         │  │  │
│  │  │  • Управление товарами (WooCommerce)               │  │  │
│  │  │  • Загрузка медиа                                  │  │  │
│  │  │  • НО: фронтенд не виден в админке                 │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  WORDPRESS (HEADLESS MODE)                                │  │
│  │  ┌────────────────────────────────────────────────────┐  │
│  │  │  WordPress REST API:                                │  │  │
│  │  │  • GET /wp-json/wp/v2/posts                          │  │  │
│  │  │  • GET /wp-json/wp/v2/pages                         │  │  │
│  │  │  • GET /wp-json/wp/v2/products (WooCommerce)        │  │  │
│  │  │  • GET /wp-json/wp/v2/media                          │  │  │
│  │  │  • POST /wp-json/wp/v2/posts (создание)             │  │  │
│  │  │  • Аутентификация: JWT или Application Password     │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  GraphQL API (опционально, через WPGraphQL):        │  │  │
│  │  │  • Более гибкие запросы                             │  │  │
│  │  │  • Меньше количество запросов                        │  │  │
│  │  │  • Типизированные запросы                           │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ REST/GraphQL API                 │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  FRONTEND APPLICATION (Vite/Node или Next.js/Nuxt)       │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Запрос данных:                                    │  │  │
│  │  │  • fetch('/wp-json/wp/v2/posts')                    │  │  │
│  │  │  • axios.get('WordPress API URL')                   │  │  │
│  │  │  • GraphQL queries                                  │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Рендеринг:                                        │  │  │
│  │  │  • Server-Side Rendering (SSR) - Next.js          │  │  │
│  │  │  • Static Site Generation (SSG) - Next.js          │  │  │
│  │  │  • Client-Side Rendering (CSR) - Vite/React       │  │  │
│  │  │  • Incremental Static Regeneration (ISR)           │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Отдача контента:                                  │  │  │
│  │  │  • Node.js/Express сервер                          │  │  │
│  │  │  • Или статический HTML (SSG)                      │  │  │
│  │  │  • Или CDN (CloudFlare, Vercel, Netlify)          │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  БРАУЗЕР ПОЛЬЗОВАТЕЛЯ                                   │  │
│  │  • Получает HTML (SSR) или статику (SSG)               │  │
│  │  • Загружает JavaScript для интерактивности            │  │
│  │  • Запрашивает дополнительные данные через API         │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

ПРЕИМУЩЕСТВА HEADLESS:
• ✅ Максимальная свобода во фронтенде
  └─ Любой JavaScript фреймворк (React, Vue, Svelte)
  └─ Сложные анимации и интерактивность
  └─ PWA (Progressive Web App)
  └─ Мобильные приложения (React Native)

• ✅ Разделение ответственности
  └─ Контент → WordPress команда
  └─ UI/UX → Frontend команда
  └─ Независимая разработка

• ✅ Масштабируемость
  └─ Фронтенд и API масштабируются отдельно
  └─ CDN для фронтенда
  └─ Кеширование на разных уровнях

• ✅ Мультиплатформенность
  └─ Один WordPress → много фронтендов
  └─ Веб-сайт, мобильное приложение, админка

НО УВЕЛИЧИВАЕТСЯ СЛОЖНОСТЬ:
• ❌ Два приложения вместо одного
• ❌ Две линии деплоя
• ❌ Синхронизация API версий
• ❌ Больше DevOps работы
• ❌ Редакторам сложнее (нет превью)
```

### Сравнительная таблица: Монолит vs Headless

| Критерий | Монолит | Headless |
|----------|---------|----------|
| **Сложность разработки** | Низкая | Высокая |
| **Сложность поддержки** | Низкая | Высокая |
| **Скорость разработки** | Быстро | Медленнее |
| **Стоимость разработки** | Низкая | Высокая |
| **Стоимость поддержки** | Низкая | Высокая |
| **Гибкость фронтенда** | Ограничена | Максимальная |
| **SEO** | Отлично (из коробки) | Требует настройки |
| **Производительность** | Хорошая (с кешем) | Отличная (SSG/SSR) |
| **Масштабируемость** | Средняя | Высокая |
| **Простота для редакторов** | Высокая | Средняя |
| **Экосистема плагинов** | Полная | Ограничена |
| **Рекомендация для проекта** | ✅ **Да (этап 1-2)** | ⚠️ Рассмотреть позже |

---

## Интеграция WooCommerce

### Схема 4.1: WooCommerce в монолите

```
┌─────────────────────────────────────────────────────────────────┐
│          WORDPRESS + WOOCOMMERCE МОНОЛИТ                        │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  АДМИНИСТРАТОР МАГАЗИНА                                  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  WooCommerce Admin:                                │  │  │
│  │  │  • Управление товарами (добавление, редактирование)│  │  │
│  │  │  • Категории и теги                                │  │  │
│  │  │  • Варианты товаров (размеры, цвета матрасов)      │  │  │
│  │  │  • Цены и скидки                                    │  │  │
│  │  │  • Заказы и статусы                                 │  │  │
│  │  │  • Клиенты                                          │  │  │
│  │  │  • Отчеты и аналитика                               │  │  │
│  │  │  • Настройки доставки                               │  │  │
│  │  │  • Настройки оплаты                                 │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  WORDPRESS + WOOCOMMERCE                                 │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  WooCommerce Плагины:                             │  │  │
│  │  │  • WooCommerce Core (базовый функционал)           │  │  │
│  │  │  • Платежные шлюзы (Сбербанк, ЮKassa, др.)        │  │  │
│  │  │  • Доставка (СДЭК, Почта России, др.)             │  │  │
│  │  │  • Интеграция с CRM (Битрикс24, amoCRM)           │  │  │
│  │  │  • Email уведомления                               │  │  │
│  │  │  • Купоны и скидки                                  │  │  │
│  │  │  • Отзывы и рейтинги                               │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Кастомная тема Grassi Grosso:                     │  │  │
│  │  │  • Шаблон каталога товаров                          │  │  │
│  │  │  • Шаблон карточки товара                           │  │  │
│  │  │  • Шаблон корзины                                   │  │  │
│  │  │  • Шаблон оформления заказа                         │  │  │
│  │  │  • Шаблон личного кабинета                          │  │  │
│  │  │  • Интеграция с текущим дизайном                    │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ПОЛЬЗОВАТЕЛЬСКИЙ ИНТЕРФЕЙС                              │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Страницы магазина:                               │  │  │
│  │  │  • /shop/ - Каталог товаров                        │  │  │
│  │  │  • /product/matras-1/ - Карточка товара           │  │  │
│  │  │  • /cart/ - Корзина                                │  │  │
│  │  │  • /checkout/ - Оформление заказа                  │  │  │
│  │  │  • /my-account/ - Личный кабинет                  │  │  │
│  │  │  • /order-received/ - Подтверждение заказа         │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

ИНТЕГРАЦИЯ С ТЕКУЩИМ ПРОЕКТОМ:
┌─────────────────────────────────────────────────────────────────┐
│  Вариант 1: Полная миграция на WordPress                        │
│  • Текущие страницы (hotels, dealers, catalog) → WP страницы   │
│  • Формы → Contact Form 7 или Gravity Forms                    │
│  • Дизайн → Кастомная тема WordPress                            │
│  • Магазин → WooCommerce                                        │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  Вариант 2: Гибридный подход                                     │
│  • Текущий лендинг (Node/Vite) → www.grassigrosso.ru           │
│  • Магазин (WordPress+WooCommerce) → shop.grassigrosso.ru      │
│  • Единый дизайн на обоих поддоменах                            │
│  • Переходы между сайтами через навигацию                       │
└─────────────────────────────────────────────────────────────────┘
```

### Схема 4.2: WooCommerce в headless-сценарии

```
┌─────────────────────────────────────────────────────────────────┐
│          HEADLESS WOOCOMMERCE АРХИТЕКТУРА                        │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  WORDPRESS + WOOCOMMERCE (HEADLESS)                      │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  WooCommerce REST API:                             │  │  │
│  │  │  • GET /wp-json/wc/v3/products                     │  │  │
│  │  │  • GET /wp-json/wc/v3/products/{id}                │  │  │
│  │  │  • GET /wp-json/wc/v3/products/categories          │  │  │
│  │  │  • POST /wp-json/wc/v3/orders (создание заказа)   │  │  │
│  │  │  • GET /wp-json/wc/v3/orders/{id}                  │  │  │
│  │  │  • Аутентификация: Consumer Key + Secret            │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ REST API                          │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  NODE.JS BACKEND (BFF - Backend For Frontend)            │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  API Endpoints:                                     │  │  │
│  │  │  • GET /api/products - Список товаров               │  │  │
│  │  │  • GET /api/products/:id - Карточка товара          │  │  │
│  │  │  • GET /api/categories - Категории                  │  │  │
│  │  │  • POST /api/cart/add - Добавить в корзину          │  │  │
│  │  │  • GET /api/cart - Получить корзину                 │  │  │
│  │  │  • POST /api/checkout - Оформить заказ              │  │  │
│  │  │  • GET /api/orders/:id - Статус заказа              │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Логика:                                            │  │  │
│  │  │  • Запрос данных из WooCommerce API                 │  │  │
│  │  │  • Кеширование в Redis (если настроено)            │  │  │
│  │  │  • Валидация данных                                 │  │  │
│  │  │  • Трансформация данных под фронтенд                │  │  │
│  │  │  • Обработка заказов                                │  │  │
│  │  │  • Интеграция с платежными системами                │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ HTTP API                          │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  FRONTEND (Vite/React или Next.js)                       │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Компоненты магазина:                               │  │  │
│  │  │  • ProductList - Список товаров                     │  │  │
│  │  │  • ProductCard - Карточка товара                    │  │  │
│  │  │  • ProductDetail - Страница товара                 │  │  │
│  │  │  • ShoppingCart - Корзина                           │  │  │
│  │  │  • CheckoutForm - Оформление заказа                 │  │  │
│  │  │  • OrderStatus - Статус заказа                      │  │  │
│  │  │  • UserAccount - Личный кабинет                     │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  State Management:                                 │  │  │
│  │  │  • Redux / Zustand / Context API                   │  │  │
│  │  │  • Корзина (localStorage + сервер)                 │  │  │
│  │  │  • Пользователь (сессии)                           │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  БРАУЗЕР ПОЛЬЗОВАТЕЛЯ                                   │  │
│  │  • SPA или SSR приложение                               │  │
│  │  • Интерактивный интерфейс магазина                     │  │
│  │  • Адаптивный дизайн                                    │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

ПРЕИМУЩЕСТВА HEADLESS WOOCOMMERCE:
• ✅ Полный контроль над UX магазина
  └─ Кастомный checkout процесс
  └─ Сложные сценарии B2B (отелям, дилерам)
  └─ Интеграция с текущим дизайном

• ✅ Единая фронтенд-платформа
  └─ Один стек для сайта и магазина
  └─ Общие компоненты и стили
  └─ Единая система аутентификации

• ✅ Оптимизация производительности
  └─ SSG для каталога товаров
  └─ Кеширование в Redis
  └─ CDN для статики

НО ТРЕБУЕТ БОЛЬШЕ РАЗРАБОТКИ:
• ❌ Нужно реализовать корзину самостоятельно
• ❌ Нужно реализовать checkout процесс
• ❌ Нужно реализовать валидацию форм
• ❌ Нужно реализовать обработку ошибок
• ❌ Нужно реализовать интеграцию с платежами
```

### Интеграция WooCommerce с текущим Node.js проектом

```
┌─────────────────────────────────────────────────────────────────┐
│          ГИБРИДНАЯ АРХИТЕКТУРА: NODE.JS + WOOCOMMERCE            │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ТЕКУЩИЙ ПРОЕКТ (Node.js + Vite)                          │  │
│  │  • Лендинг страницы (index, hotels, dealers)              │  │
│  │  • Формы обратной связи                                   │  │
│  │  • API для форм (/api/submit)                             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ Расширение                        │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  NODE.JS SERVER (server.cjs) - РАСШИРЕННЫЙ                │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Новые API endpoints:                              │  │  │
│  │  │  • GET /api/products - Список товаров из WooCommerce│  │  │
│  │  │  • GET /api/products/:id - Карточка товара         │  │  │
│  │  │  • GET /api/categories - Категории товаров          │  │  │
│  │  │  • POST /api/cart - Управление корзиной              │  │  │
│  │  │  • POST /api/checkout - Оформление заказа            │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  WooCommerce API Client:                             │  │  │
│  │  │  • axios запросы к WordPress REST API                │  │  │
│  │  │  • Аутентификация (Consumer Key + Secret)            │  │  │
│  │  │  • Кеширование ответов в Redis                       │  │  │
│  │  │  • Обработка ошибок                                  │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              │ REST API                          │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  WORDPRESS + WOOCOMMERCE (на отдельном сервере/поддомене)│  │
│  │  • Управление товарами через админку                     │  │
│  │  • REST API для получения данных                        │  │
│  │  • Обработка заказов                                     │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│                              ▼                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  FRONTEND (Vite) - РАСШИРЕННЫЙ                           │  │
│  │  • Новые страницы:                                       │  │
│  │    - /shop.html - Каталог товаров                        │  │
│  │    - /product.html - Карточка товара                     │  │
│  │    - /cart.html - Корзина                                │  │
│  │    - /checkout.html - Оформление заказа                  │  │
│  │  • JavaScript логика для магазина                         │  │
│  │  • Интеграция с текущим дизайном                         │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

---

## Дорожная карта развития

### Этап 1: Текущее состояние (✅ Реализовано)

```
┌─────────────────────────────────────────────────────────────────┐
│  ТЕКУЩАЯ АРХИТЕКТУРА                                             │
│                                                                   │
│  ✅ Статический лендинг на Vite                                  │
│     • Многостраничный сайт (5 страниц)                           │
│     • Оптимизированная сборка                                    │
│     • Hot Module Replacement в dev                               │
│                                                                   │
│  ✅ Node.js + Express backend                                    │
│     • API для обработки форм                                      │
│     • Отдача статики в production                                │
│     • Проксирование на Vite в dev                                 │
│                                                                   │
│  ✅ Интеграция с Telegram                                        │
│     • Отправка заявок в Telegram                                  │
│     • Мгновенные уведомления менеджерам                          │
│                                                                   │
│  ✅ Docker контейнеризация                                       │
│     • Multi-stage build                                           │
│     • Готовность к деплою                                         │
│                                                                   │
│  🔄 В РАЗРАБОТКЕ:                                                │
│     • Email отправка заявок (SMTP)                               │
│     • Двойная отправка: Telegram + Email                         │
└─────────────────────────────────────────────────────────────────┘
```

### Этап 2: Система администрирования (📅 Планируется, с опциональным Битрикс24)

```
┌─────────────────────────────────────────────────────────────────┐
│  ВНЕДРЕНИЕ WORDPRESS                                              │
│                                                                   │
│  📋 Вариант A: Монолит (рекомендуется)                           │
│     • Установка WordPress на поддомене или основном домене       │
│     • Создание кастомной темы с текущим дизайном                 │
│     • Миграция контента из статических страниц                   │
│     • Настройка форм через Contact Form 7                        │
│     • Интеграция форм с текущим Node.js API (или прямые отправки │
│       из WordPress на Email/Telegram)                            │
│     • SEO оптимизация (Yoast SEO)                                │
│                                                                   │
│  📋 Вариант B: Headless (альтернатива)                           │
│     • WordPress как headless CMS                                 │
│     • REST API для получения контента                            │
│     • Текущий Vite проект расширяется для работы с API           │
│     • Генерация статики из WordPress контента                    │
│                                                                   │
│  📋 Опционально на этом же этапе:                                │
│     • Базовая интеграция с CRM Битрикс24 через вебхуки/REST API  │
│       без сложной автоматизации воронки                           │
│     • Создание лида при отправке формы                           │
│     • Сохранение основной логики (Telegram + Email)              │
└─────────────────────────────────────────────────────────────────┘
```

### Этап 3: Масштабирование производительности (⚠️ При высокой посещаемости, после запуска админки)

```
┌─────────────────────────────────────────────────────────────────┐
│  ОПТИМИЗАЦИИ ПРОИЗВОДИТЕЛЬНОСТИ                                 │
│  (ПРИМЕНЯЮТСЯ ПОСЛЕ ВНЕДРЕНИЯ WORDPRESS/СИСТЕМЫ АДМИНИСТРИРОВАНИЯ)│
│                                                                   │
│  📋 Redis кеширование:                                           │
│     • Кеширование API ответов                                    │
│     • Rate limiting для защиты от спама                          │
│     • Счетчики и аналитика                                       │
│     • Сессии пользователей (если появится авторизация)           │
│                                                                   │
│  📋 Генерация статики через Node.js:                             │
│     • Пререндер каталога товаров (если появится)                 │
│     • Генерация SEO-страниц                                      │
│     • Инкрементальная регенерация по webhook                     │
│     • CDN-friendly контент                                       │
│                                                                   │
│  📋 Мониторинг и аналитика:                                      │
│     • Логирование запросов                                       │
│     • Метрики производительности                                 │
│     • Алерты при ошибках                                         │
└─────────────────────────────────────────────────────────────────┘
```

### Этап 4: Интернет-магазин (📅 Планируется)

```
┌─────────────────────────────────────────────────────────────────┐
│  ИНТЕГРАЦИЯ WOOCOMMERCE                                          │
│                                                                   │
│  📋 В монолите:                                                  │
│     • Установка WooCommerce плагина                              │
│     • Настройка каталога товаров                                 │
│     • Настройка способов оплаты                                  │
│     • Настройка доставки                                         │
│     • Интеграция с CRM (Битрикс24)                               │
│     • Email уведомления о заказах                                │
│                                                                   │
│  📋 В headless-сценарии:                                         │
│     • WooCommerce REST API                                        │
│     • Кастомный фронтенд магазина                                │
│     • Интеграция с текущим Node.js backend                       │
│     • Кеширование в Redis                                        │
│     • SSG для каталога                                           │
└─────────────────────────────────────────────────────────────────┘
```

### Детализация интеграции с CRM Битрикс24 (опционально в рамках Этапа 2)

```
┌─────────────────────────────────────────────────────────────────┐
│  ИНТЕГРАЦИЯ С БИТРИКС24                                          │
│                                                                   │
│  📋 Расширение API /api/submit (в рамках Этапа 2, опционально):  │
│     • Сохранение текущей логики (Telegram + Email)               │
│     • Добавление отправки в Битрикс24                            │
│     • Создание лида/сделки через REST API                        │
│     • Обработка ошибок и fallback                                │
│                                                                   │
│  📋 Преимущества:                                                │
│     • Автоматическое создание лидов                              │
│     • Назначение ответственных менеджеров                        │
│     • Автоматизация воронки продаж                               │
│     • История коммуникаций                                      │
│     • Аналитика и отчеты                                        │
│     • Интеграция с телефонией                                    │
└─────────────────────────────────────────────────────────────────┘
```

### Визуальная временная шкала

```
ВРЕМЯ →
│
├─ ЭТАП 1 (✅ СЕЙЧАС)
│  └─ Vite + Node.js + Telegram + Docker
│     └─ 🔄 Email отправка (в разработке)
│
├─ ЭТАП 2 (📅 БЛИЖАЙШЕЕ БУДУЩЕЕ)
│  └─ WordPress монолит / headless
│  └─ Миграция контента
│  └─ (опционально) базовая интеграция с Битрикс24
│
├─ ЭТАП 3 (⚠️ ПРИ ВЫСОКОЙ НАГРУЗКЕ)
│  └─ Redis кеширование
│  └─ Генерация статики (SSG)
│
├─ ЭТАП 4 (📅 СРЕДНЕСРОЧНАЯ ПЕРСПЕКТИВА)
│  └─ WooCommerce
│  └─ Интернет-магазин
│
└─ ДАЛЬНЕЙШЕЕ УГЛУБЛЕНИЕ
   └─ Расширенная автоматизация процессов в Битрикс24
   └─ Сложные воронки и сквозная аналитика
```

---

## Технические детали

### Переменные окружения

```env
# Server
PORT=3000
NODE_ENV=production

# Telegram
BOT_TOKEN=your_telegram_bot_token
CHAT_ID=your_telegram_chat_id

# Email (Этап 1)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=noreply@grassigrosso.ru
SMTP_PASS=your_app_password
EMAIL_TO=sales@grassigrosso.ru

# WordPress API (будущее)
WP_API_URL=https://wordpress.grassigrosso.ru/wp-json
WP_API_USER=api_user
WP_API_PASS=api_password

# WooCommerce API (будущее)
WC_CONSUMER_KEY=ck_xxxxx
WC_CONSUMER_SECRET=cs_xxxxx

# Битрикс24 (будущее)
BITRIX24_WEBHOOK_URL=https://your-domain.bitrix24.ru/rest/1/xxxxx/
BITRIX24_USER_ID=1

# Redis (будущее, при высокой нагрузке)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
```

### Зависимости проекта

```json
{
  "dependencies": {
    "axios": "^1.6.0",           // HTTP клиент для API запросов
    "cors": "^2.8.5",            // CORS middleware
    "dotenv": "^16.3.1",         // Переменные окружения
    "express": "^4.18.2",        // Web framework
    "gsap": "^3.14.2",           // Анимации на фронтенде
    "http-proxy-middleware": "^3.0.5",  // Прокси для dev режима
    "nodemailer": "^6.9.0"       // Email отправка (добавить)
  },
  "devDependencies": {
    "vite": "^7.2.4"             // Build tool
  }
}
```

### Будущие зависимости (при масштабировании)

```json
{
  "dependencies": {
    "redis": "^4.6.0",           // Redis клиент (для кеширования)
    "ioredis": "^5.3.0",          // Альтернативный Redis клиент
    "puppeteer": "^21.0.0",       // Для генерации статики (SSG)
    "cheerio": "^1.0.0",          // HTML парсинг для SSG
    "axios": "^1.6.0"             // Уже есть, для WordPress API
  }
}
```

---

## Заключение

Данный документ описывает текущую архитектуру проекта Grassi Grosso и планы его развития. 

**Ключевые преимущества текущей архитектуры:**
- ⚡ **Vite** - быстрая разработка и оптимизированная сборка
- 🐳 **Docker** - контейнеризация для легкого деплоя
- 📧 **Email + Telegram** - двойная отправка заявок (на этапе внедрения)
- 🚀 **Масштабируемость** - готовность к росту через Redis и SSG

**Планы развития:**
1. ✅ Этап 1: Email отправка (в разработке)
2. ⚠️ Этап 2: Оптимизации при высокой нагрузке (Redis, SSG)
3. 📅 Этап 3: WordPress монолит для администрирования
4. 📅 Этап 4: WooCommerce для интернет-магазина
5. 📅 Этап 5: Интеграция с Битрикс24 CRM

Все схемы и описания готовы для переноса в Figma Jam с пометками и комментариями.
